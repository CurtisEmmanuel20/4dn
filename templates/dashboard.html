{% extends 'base.html' %}
{% block content %}
<div class="container-fluid" style="margin-top:1.5rem;">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="alert alert-info d-flex align-items-center justify-content-center fw-bold shadow-lg" style="background:linear-gradient(90deg,#181c24 0%,#23272f 100%); color:#ffe066; font-size:1.35rem; border-radius:1.2rem; border:2px solid #23272f; letter-spacing:1px; padding:1.1rem 1.5rem; box-shadow:0 2px 16px #00bfff33;">
        <span style="font-size:1.5rem; margin-right:0.7rem; color:#00bfff;">üöÄ</span>
        4DN Fantasy Season Opens <span style="color:#00ff99; margin:0 0.5rem; font-weight:900; text-shadow:0 0 8px #00ff9966;">August 1st</span>
      </div>
    </div>
  </div>
</div>
<style>
  .stat-card {
    background: linear-gradient(120deg, #23272f 60%, #00bfff22 100%);
    border-radius: 1.1rem;
    box-shadow: 0 2px 16px 0 rgba(0,255,153,0.08), 0 1px 4px 0 rgba(0,191,255,0.08);
    color: #f5f6fa;
    transition: box-shadow 0.2s, transform 0.15s;
    padding: 1.3rem 0.7rem 1rem 0.7rem;
    min-height: 180px; /* Increased for uniformity */
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-bottom: 1rem;
    position: relative;
    overflow: hidden;
  }
  .stat-card-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem 0;
  }
  @media (min-width: 768px) {
    .stat-card-row > div {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .stat-card {
      height: 100%;
      min-height: 220px;
    }
  }
  .stat-card .stat-title {
    font-size: 0.95rem;
    font-weight: 700;
    color: #00ff99;
    letter-spacing: 0.5px;
    margin-bottom: 0.2rem;
    text-transform: uppercase;
  }
  .stat-card .stat-value {
    font-size: 1.5rem;
    font-weight: 800;
    color: #ffe066;
    margin-bottom: 0.1rem;
    letter-spacing: 0.5px;
    text-shadow: 0 0 4px #00ffd0a0;
  }
  .stat-card .stat-sub {
    font-size: 0.92rem;
    color: #b8c1ec;
    margin-top: 0.1rem;
    font-weight: 500;
  }
  .stat-card .start, .stat-card .sit {
    font-size: 1rem;
    padding: 0.15em 0.7em;
  }
  /* Special Offer Card */
  .stat-card.text-center.p-4 {
    padding: 1.2rem 0.7rem !important;
    border-width: 1.5px !important;
  }
  .stat-card .stat-title.mb-2 {
    font-size: 1.05rem !important;
  }
  .stat-card .stat-value.mb-1 {
    font-size: 1.5rem !important;
  }
  .stat-card .stat-sub.mb-2 {
    font-size: 0.95rem !important;
  }
  .btn, .btn-lg, .btn-accent, .btn-warning, .btn-success {
    font-size: 0.98rem !important;
    padding: 0.6rem 1.2rem !important;
    border-radius: 0.5rem !important;
  }
  .badge, .bg-warning, .bg-secondary {
    font-size: 0.85rem !important;
    padding: 0.3em 0.7em !important;
  }
  /* Table font size */
  .table, .table th, .table td {
    font-size: 0.95rem !important;
  }
  /* News Card font size */
  .news-item-card {
    min-width: 220px;
    max-width: 240px;
    font-size: 0.95rem;
    padding: 0.7rem 0.6rem !important;
  }
  .news-item-card div {
    font-size: 0.95rem !important;
  }
  /* Chat font size */
  #chat-log, .chat-msg-user, .chat-msg-ai {
    font-size: 0.98rem !important;
    padding: 0.5em 0.8em !important;
  }
  #chat .card-header, #chat .card-title, #chat .card {
    font-size: 1rem !important;
    padding: 0.7rem 1rem !important;
  }
  /* Big Board Card Style */
  .big-board-card {
    background: linear-gradient(120deg, #181c24 80%, #00bfff22 100%);
    border-radius: 1.5rem;
    box-shadow: 0 4px 32px 0 rgba(0,191,255,0.10), 0 1px 8px 0 rgba(0,255,153,0.10);
    border: 2.5px solid #00bfff44;
    padding: 2.2rem 1.2rem 1.2rem 1.2rem;
    margin-bottom: 2.5rem;
    position: relative;
    overflow: hidden;
    transition: box-shadow 0.2s, transform 0.15s;
  }
  .big-board-card h4 {
    font-size: 2.1rem;
    font-weight: 900;
    color: #00bfff;
    letter-spacing: 2px;
    text-shadow: 0 2px 12px #00bfff33, 0 0 2px #fff;
    margin-bottom: 0.2rem;
  }
  .big-board-card small {
    color: #ffe066;
    font-size: 1.08rem;
    font-weight: 600;
    letter-spacing: 1px;
    margin-bottom: 1.2rem;
    display: block;
  }
  .big-board-card .table {
    background: transparent;
    border-radius: 1rem;
    box-shadow: 0 2px 12px #00bfff11;
  }
  .big-board-card thead tr {
    background: linear-gradient(90deg,#23272f 60%,#00bfff22 100%);
    color: #00ff99;
    font-size: 1.08rem;
    font-weight: 700;
    letter-spacing: 1px;
  }
  .big-board-card tbody tr {
    transition: background 0.15s;
  }
  .big-board-card tbody tr:hover {
    background: #00bfff11 !important;
    box-shadow: 0 2px 8px #00bfff22;
  }
  .score-badge {
    background: linear-gradient(90deg,#ffe066 60%,#00bfff 100%);
    color: #181c24;
    font-weight: 700;
    border-radius: 0.5rem;
    padding: 0.3em 0.9em;
    font-size: 1.08rem;
    box-shadow: 0 0 8px #ffe06655;
  }
  .player-avatar {
    border-radius: 50%;
    border: 2px solid #00bfff44;
    box-shadow: 0 2px 8px #00bfff22;
    width: 38px;
    height: 38px;
    margin-right: 0.5rem;
  }
  .badge.bg-info {
    background: linear-gradient(90deg,#00bfff 60%,#00ff99 100%) !important;
    color: #181c24 !important;
    font-weight: 700;
    font-size: 1.01rem !important;
    border-radius: 0.5rem;
    box-shadow: 0 0 8px #00ffd055;
  }
  .badge.bg-secondary {
    background: linear-gradient(90deg,#23272f 60%,#00bfff22 100%) !important;
    color: #00bfff !important;
    font-weight: 700;
    font-size: 1.01rem !important;
    border-radius: 0.5rem;
    box-shadow: 0 0 8px #00bfff22;
  }
  .table th, .table td {
    vertical-align: middle !important;
  }
  /* Exciting section header */
  .section-header {
    font-size: 2.2rem;
    font-weight: 900;
    color: #ffe066;
    letter-spacing: 2px;
    text-shadow: 0 2px 12px #00bfff33, 0 0 2px #fff;
    margin-bottom: 1.2rem;
    margin-top: 2.2rem;
    text-align: center;
  }
</style>
<div class="container-fluid py-4">
  <div class="row g-4 stat-card-row">
    <!-- Stat Cards -->
    <div class="col-12 col-md-4 d-flex align-items-stretch">
      <div class="stat-card text-center w-100">
        <div class="stat-title"><span style="font-size:1.2rem;vertical-align:middle;">üìÖ</span> {{ countdown_label }}</div>
        <div class="stat-value">{{ countdown_value }}</div>
        <div class="stat-sub">NFL Regular Season</div>
      </div>
    </div>
    <div class="col-12 col-md-4 d-flex align-items-stretch">
      <div class="stat-card text-center w-100">
        <div class="stat-title" style="color:#00bfff;font-size:1.2rem;">About 4DN Fantasy</div>
        <div class="stat-value" style="font-size:1.1rem;color:#ffe066;font-weight:600;line-height:1.3;white-space:normal;">
          4DN is a data-driven platform designed to give serious managers a true analytical advantage. Our proprietary scoring system simplifies complex insights into clear, meaningful projections that help you make smarter decisions all season long.
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4 d-flex align-items-stretch">
      <div class="stat-card text-center w-100">
        <div class="stat-title"><span style="font-size:1.2rem;vertical-align:middle;">üîí</span> Your Season Pass</div>
        <div class="stat-value">
          {% if session.get('season_pass') %}
            <span class="start">Active</span>
          {% else %}
            <span class="sit">Inactive</span>
          {% endif %}
        </div>
        <div class="stat-sub">Unlocks all features</div>
        <div class="mt-3">
          <button class="btn btn-accent btn-lg w-100" style="background:linear-gradient(90deg,#00bfff 0%,#00ff99 100%);color:#181c24;font-weight:700;border:none;box-shadow:0 0 8px #00ffd0a0;letter-spacing:1px;" data-bs-toggle="modal" data-bs-target="#seasonPassModal">Get Season Pass</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Combined Special Offer Card: Summer Pre-Sale (Lifetime Pass) -->
  <div class="row g-4 mb-4">
    <div class="col-12">
      <div class="stat-card text-center p-4" style="border:2.5px solid orange; background:linear-gradient(120deg,#23272f 60%,#ffe06633 100%); box-shadow:0 4px 32px 0 rgba(255,165,0,0.15); width:100%; max-width:100%; min-width:0;">
        <div class="stat-title mb-2" style="color:orange; font-size:1.3rem; letter-spacing:1px;">üî• $9 Summer Pre-Sale <span class="badge bg-warning text-dark ms-2" style="font-size:1rem;">Limited Time</span></div>
        <div class="stat-value mb-1" style="color:orange; font-size:2.2rem; font-weight:800;">$9 One-Time</div>
        <div class="stat-sub mb-2" style="color:#ffe066; font-size:1.08rem; font-weight:600;">Lifetime Access to All Features</div>
        <div class="mb-2" style="color:orange; font-weight:700; font-size:1.08rem;">Preorder special ends July 16th</div>
        <a href="/account#subscription" class="btn btn-warning btn-lg px-4 mb-2 w-100" style="color:#23272f; font-weight:700; letter-spacing:1px; background:linear-gradient(90deg,#ffe066 60%,#ffb300 100%); border:none; box-shadow:0 0 8px #ffe066a0;">Get Lifetime Pass for $9</a>
      </div>
    </div>
  </div>
  <!-- 4DN Fantasy Big Board (Modernized) -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="big-board-card">
        <h4 class="mb-0 fw-bold">üèà 4DN Fantasy Big Board</h4>
        <small>Top 100 | Updated Weekly | Proprietary 4DN Score</small>
        <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
          <div></div>
          <select id="positionFilter" class="form-select form-select-sm bg-dark text-light w-auto ms-3" style="min-width:120px;border:1px solid #00bfff;">
            <option value="QB" selected>QB</option>
            <option value="RB">RB</option>
            <option value="WR">WR</option>
            <option value="TE">TE</option>
            <option value="K">K</option>
            <option value="DST">Defense</option>
          </select>
        </div>
        <div class="table-responsive" style="border-radius:1rem; max-height:540px; overflow-y:auto;">
          <table class="table table-dark table-hover align-middle mb-0" style="font-size:1.01rem;">
            <thead style="background:rgba(0,191,255,0.08);">
              <tr style="color:#00ff99;">
                <th class="text-center">#</th>
                <th style="color:#00bfff;">Pos Rank</th>
                <th>Player</th>
                <th>Team</th>
                <th>Pos</th>
                <th>Bye</th>
                <th style="color:#ffe066; position:relative;">
                  4DN Score
                  <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="top" title="The 4DN Score is a proprietary ranking based on expert consensus, positional value, and a custom decay formula to highlight top fantasy assets." style="cursor: pointer; color: #00bfff; margin-left: 4px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                      <path d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
                      <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .877-.252 1.02-.797.07-.258.106-.422.288-.422.194 0 .234.176.162.422-.146.545-.487.797-1.02.797-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.288-.469l-.45-.083.082-.38 2.29-.287c.287-.036.352-.176.288-.469l-.738-3.468c-.194-.897.105-1.319.808-1.319.545 0 .877.252 1.02.797.07.258.106.422.288.422.194 0 .234-.176.162-.422-.146-.545-.487-.797-1.02-.797-.703 0-1.002.422-.808 1.319l.738 3.468c.064.293.006.399-.288.469z"/>
                    </svg>
                  </span>
                </th>
                <!-- <th>FPros</th> -->
                <!-- <th>Yahoo ADP</th> -->
                <!-- <th>Proj Pts</th> -->
                <!-- <th>SOS</th> -->
                <!-- <th>RedZone</th> -->
              </tr>
            </thead>
            <tbody id="big-board-table">
              <!-- Injected by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- Fantasy Football News Ticker -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card bg-dark text-light shadow mb-4" style="border-left: 4px solid #00bfff;">
        <div class="card-header d-flex align-items-center" style="background: #181c24;">
          <span style="font-size:1.3rem; color:#00bfff; margin-right:0.5rem;">üì∞</span>
          <h6 class="mb-0" style="letter-spacing:1px; font-weight:700; color:#00bfff;">Fantasy Football News</h6>
        </div>
        <div class="card-body py-2 px-0">
          <div id="news-ticker" class="d-flex flex-nowrap overflow-auto gap-3 px-3" style="scrollbar-width:thin;">
            <!-- News items injected by JS -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- AI Chat Assistant -->
  <div class="row mt-5" id="chat">
    <div class="col-12 col-lg-8 mx-auto">
      <div class="card shadow-lg border-0" style="border-radius:1.5rem; background:linear-gradient(120deg,#23272f 80%,#00bfff22 100%);">
        <div class="card-header d-flex align-items-center" style="background:linear-gradient(90deg,#181c24 70%,#00bfff22 100%); border-top-left-radius:1.5rem; border-top-right-radius:1.5rem; border-bottom:1px solid #23272f;">
          <span style="font-size:1.5rem; color:#00bfff; margin-right:0.7rem;">ü§ñ</span>
          <h4 class="mb-0 fw-bold" style="color:#00bfff; letter-spacing:1px;">Fantasy Assistant AI Chat</h4>
        </div>
        <div class="card-body p-4" style="background:transparent;">
          <div id="chat-log" class="bg-dark rounded-4 p-4 mb-3 shadow-sm" style="height: 240px; max-height: 240px; overflow-y: auto; font-size:1.08rem; color:#ffe066; border:1.5px solid #00bfff33; box-shadow:0 2px 12px #00bfff22;">
            <!-- Chat messages injected here -->
          </div>
          <div class="input-group mb-2 rounded-3 shadow-sm" style="overflow:hidden; border:1.5px solid #00bfff33; background:linear-gradient(90deg,#23272f 80%,#00bfff22 100%);">
            <textarea id="chat-input" class="form-control border-0 bg-transparent text-light" placeholder="Type your fantasy football question..." rows="2" style="resize:none; font-size:1.08rem; box-shadow:none;"></textarea>
            <button id="chat-submit" class="btn btn-accent" type="button" style="background:linear-gradient(90deg,#00bfff 0%,#00ff99 100%); color:#181c24; font-weight:700; border:none; border-radius:0; letter-spacing:1px; min-width:120px;">Ask 4DN</button>
          </div>
          <small class="text-muted d-block mt-2" style="color:#b0b6c3!important;">Start/Sit, trade, and matchup advice powered by GPT-4o and real stats.</small>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal: Summer Pre-Sale (Lifetime Pass) Info -->
<div class="modal fade" id="seasonPassModal" tabindex="-1" aria-labelledby="seasonPassModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="background:#181c24; color:#f5f6fa; border-radius:1.5rem; box-shadow:0 4px 32px #00bfff33;">
      <div class="modal-header" style="border-bottom:1px solid #23272f; background:#23273a; border-top-left-radius:1.5rem; border-top-right-radius:1.5rem;">
        <h3 class="modal-title fw-bold" id="seasonPassModalLabel" style="color:#00bfff; letter-spacing:1px;">$9 Summer Pre-Sale: Unlock Lifetime Access</h3>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <div class="mb-3" style="font-size:1.15rem; color:#ffe066; font-weight:600;">Unlock the AI-powered 4DN Fantasy Toolkit ‚Äî a precision-grade analytics suite built to give you a winning edge, forever. Our proprietary algorithms power every tool, delivering high-probability picks and actionable insights to elevate your decision-making.</div>
        <div class="mb-4">
          <h5 style="color:#00ff99; font-weight:700;">What You Get with the Lifetime Pass:</h5>
          <ul class="list-unstyled mb-4" style="font-size:1.08rem;">
            <li class="mb-3"><span style="color:#00bfff; font-weight:700;">Daily Fantasy Hub</span><br><span style="color:#b0b6c3;">Maximize value on platforms like DraftKings and FanDuel with optimized lineup suggestions, player volatility profiles, and real-time performance projections.</span></li>
            <li class="mb-3"><span style="color:#00bfff; font-weight:700;">Sharp Bets</span><br><span style="color:#b0b6c3;">Gain access to AI-suggested prop plays, spreads, and game lines with confidence ratings rooted in player momentum, injury trends, and market movement analysis.</span></li>
            <li class="mb-3"><span style="color:#00bfff; font-weight:700;">Start/Sit Advisor</span><br><span style="color:#b0b6c3;">Make smarter weekly lineup choices with our 25-factor engine analyzing matchup difficulty, red zone usage, injury updates, weather risk, and more.</span></li>
            <li class="mb-3"><span style="color:#00bfff; font-weight:700;">Elite Matchups</span><br><span style="color:#b0b6c3;">Get weekly spotlights on high-upside breakout candidates‚Äîalgorithmically selected based on matchup grading, snap share trends, and historical performance data.</span></li>
            <li class="mb-3"><span style="color:#00bfff; font-weight:700;">Player Rankings</span><br><span style="color:#b0b6c3;">Explore sortable player tiers powered by live updates, consistency ratings, team context, and our custom 4DN risk/reward index.</span></li>
          </ul>
        </div>
        <div class="p-4 rounded-4 mb-2" style="background:linear-gradient(90deg,#00bfff22 60%,#00ff9922 100%); border:1.5px solid #00bfff;">
          <div class="fw-bold mb-2" style="font-size:1.25rem; color:#ffe066;">Lifetime Special: Only $9 Through July 16th</div>
          <div style="color:#f5f6fa; font-size:1.08rem;">The Lifetime Pass is normally <span style="color:#ffe066; font-weight:600;">$99</span>, but you can lock it in for just <span style="color:#00ff99; font-weight:700;">$9</span> when you preorder now. Covers full access to all features, forever. <span style="color:#00bfff;">One-time payment. No subscriptions. Full value for life.</span></div>
        </div>
        <div class="mt-4 p-3 rounded-4" style="background:#23273a; border:1.5px solid #00bfff33;">
          <div class="mb-2" style="color:#ffe066; font-size:1.08rem; font-weight:600;">How to Get Your Lifetime Pass:</div>
          <ol class="mb-0" style="color:#b0b6c3; font-size:1.05rem;">
            <li class="mb-2"> <a href="/login" class="text-info fw-bold">Log in</a> or <a href="/signup" class="text-success fw-bold">Sign up</a> for a free 4DN account.</li>
            <li class="mb-2"> Go to your <a href="/account" class="text-accent fw-bold">Account page</a>.</li>
            <li> Click <span class="fw-bold text-accent">Buy Lifetime Pass</span> to unlock all features instantly!</li>
          </ol>
        </div>
      </div>
      <div class="modal-footer" style="background:#23273a; border-bottom-left-radius:1.5rem; border-bottom-right-radius:1.5rem; border-top:1px solid #23272f;">
        <button type="button" class="btn btn-accent btn-lg px-4" style="background:linear-gradient(90deg,#00bfff 0%,#00ff99 100%); color:#181c24; font-weight:700; border:none; letter-spacing:1px;" data-bs-dismiss="modal">Close</button>
        <a href="/buy-season-pass" class="btn btn-success btn-lg px-4" style="font-weight:700; letter-spacing:1px;">Get Lifetime Pass for $9</a>
      </div>
    </div>
  </div>
</div>
<script>
// Set QB as default filter on load
let fullBigBoard = [];

function renderBigBoard(players, filter = 'QB') {
  const tbody = document.getElementById('big-board-table');
  tbody.innerHTML = '';

  // Compute position ranks for the filtered list
  let filtered = players.filter(p => filter === 'ALL' ? true : p.position === filter);
  // Sort by overall rank (or 4dn_score if needed)
  filtered = filtered.sort((a, b) => (a.rank || 9999) - (b.rank || 9999));
  // Assign position rank
  filtered.forEach((player, idx) => player._posRank = idx + 1);

  filtered.forEach(player => {
    const row = document.createElement('tr');
    // Use a placeholder avatar for realism
    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(player.name)}&background=23272f&color=00bfff&size=72&bold=true`;
    row.innerHTML = `
      <td class="text-center fw-bold" style="font-size:1.1rem;">${player.rank}</td>
      <td><span class="badge bg-info text-dark" style="font-size:1rem;">${player._posRank}</span></td>
      <td class="d-flex align-items-center">
        <img src="${avatarUrl}" class="player-avatar me-2" alt="${player.name}">
        <span class="fw-semibold">${player.name}</span>
      </td>
      <td style="font-weight:600;letter-spacing:1px;">${player.team}</td>
      <td><span class="badge bg-secondary" style="font-size:1rem;">${player.position}</span></td>
      <td>${player.bye || '-'}</td>
      <td><span class="score-badge">${player['4dn_score']?.toFixed(2) ?? '-'}</span></td>
    `;
    tbody.appendChild(row);
  });
}

fetch('/api/fantasy-big-board')
  .then(res => res.json())
  .then(data => {
    fullBigBoard = data;
    renderBigBoard(fullBigBoard, 'QB');
  })
  .catch(err => {
    document.getElementById('big-board-table').innerHTML =
      `<tr><td colspan="11" class="text-center">Error loading Big Board</td></tr>`;
    console.error(err);
  });

document.getElementById('positionFilter').addEventListener('change', (e) => {
  renderBigBoard(fullBigBoard, e.target.value);
});

document.getElementById("chat-submit").addEventListener("click", async () => {
  const input = document.getElementById("chat-input").value;
  const chatLog = document.getElementById("chat-log");
  if (!input) return;
  chatLog.innerHTML += `<div class="chat-msg-user"><strong>You:</strong> ${input}</div>`;
  document.getElementById("chat-input").value = "";
  const response = await fetch("/api/fantasy-chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: input })
  });
  const data = await response.json();
  chatLog.innerHTML += `<div class="chat-msg-ai"><strong>4DN:</strong> ${data.response ? data.response : (data.error || 'Sorry, something went wrong.')}</div>`;
  chatLog.scrollTop = chatLog.scrollHeight;
});

// Logout function
function logout() {
  fetch('/logout', { method: 'POST' })
    .then(() => window.location.href = '/')
    .catch(() => window.location.href = '/');
}

// Fetch and display news ticker items
function fetchNewsTicker() {
  fetch('/api/fantasy-news')
    .then(res => res.json())
    .then(data => {
      const ticker = document.getElementById('news-ticker');
      ticker.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'py-2';
        div.innerHTML = `
          <a href="${item.url}" target="_blank" class="text-light text-decoration-none">
            <strong>${item.headline}</strong> - ${item.source}
          </a>
        `;
        ticker.appendChild(div);
      });
    })
    .catch(err => console.error('Error loading news ticker:', err));
}

// Initial fetch for news ticker
fetchNewsTicker();

fetch('/api/news')
  .then(res => res.json())
  .then(news => {
    const ticker = document.getElementById('news-ticker');
    if (!ticker) return;
    ticker.innerHTML = '';
    news.forEach(item => {
      const card = document.createElement('div');
      card.className = 'news-item-card p-3 mb-2';
      card.style = `min-width: 220px; max-width: 240px; font-size: 0.95rem; padding: 0.7rem 0.6rem !important; background: linear-gradient(120deg, #23272f 80%, #00bfff22 100%); border-radius: 1rem; box-shadow: 0 2px 12px 0 rgba(0,191,255,0.10); border-left: 3px solid #00bfff; flex: 0 0 auto;`;
      card.innerHTML = `
        <div style='font-size:1.05rem;font-weight:700;color:#ffe066;'>
          <a href="${item.url || '#'}" target="_blank" rel="noopener noreferrer" style="color:#ffe066;text-decoration:underline;">
            ${item.headline}
          </a>
        </div>
        <div class='text-muted small mb-1' style='color:#b8c1ec!important;'>${item.time}</div>
        <div style='font-size:0.98rem;color:#f5f6fa;'>${item.summary}</div>
      `;
      ticker.appendChild(card);
    });
  })
  .catch(() => {
    const ticker = document.getElementById('news-ticker');
    if (ticker) ticker.innerHTML = '<div class="text-danger">Could not load news.</div>';
  });

document.addEventListener('DOMContentLoaded', function() {
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  // Auto-open Season Pass modal if requested via query param
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('openSeasonPass') === '1') {
    const spModal = document.getElementById('seasonPassModal');
    if (spModal) {
      var modal = bootstrap.Modal.getOrCreateInstance(spModal);
      modal.show();
    }
  }
});
</script>
{% endblock %}
